<div class="order-page">
  <!-- Header -->
  <div class="header">
    <button class="header-actions" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <span class="title">Pedido</span>
    <button class="header-actions">
      <mat-icon>favorite_border</mat-icon>
    </button>
  </div>

  <!-- Delivery / Pickup Tabs -->
  <div class="custom-tabs-wrapper">
    <app-tabs>
      <app-tab label="Delivery">Delivery</app-tab>
      <app-tab label="Retirada">Retirada</app-tab>
    </app-tabs>
  </div>

  <!-- Delivery Address -->
  <div class="address-section">
    <h3>Endereço de entrega</h3>
    <p class="address-title">São Paulo</p>
    <p class="address-sub">
      Av. Brigadeiro Faria Lima, 123 - Pinheiros
    </p>
  </div>

  <mat-divider></mat-divider>

  <!-- Product -->
  <div class="product-info" *ngIf="coffee$ | async as coffee">
    <div class="product">
      <img [src]="coffee.image" [alt]="coffee.name" />
      <div class="details">
        <h4>{{ coffee.name }}</h4>
        <span class="sub">{{ coffee.type }}</span>
      </div>

      <div class="quantity">
        <button class="quantity-button" mat-icon-button (click)="decreaseQuantity()">
          <mat-icon>remove</mat-icon>
        </button>

        <span class="quantity-value">{{ orderForm.get('quantity')?.value }}</span>

        <button class="quantity-button" mat-icon-button (click)="increaseQuantity()">
          <mat-icon>add</mat-icon>
        </button>
      </div>
    </div>

    <mat-divider></mat-divider>

    <!-- Cupom de desconto -->
    <div class="discount" *ngIf="coupon$ | async as coupon; else noCoupon">
      <mat-icon>local_offer</mat-icon>
      <div class="discount-info">
        <span>{{ coupon.description }}</span>
      </div>
      <mat-icon class="arrow">chevron_right</mat-icon>
    </div>

    <ng-template #noCoupon>
      <div class="discount unavailable">
        <mat-icon>local_offer</mat-icon>
        <span>Nenhum cupom disponível</span>
      </div>
    </ng-template>

    <mat-divider></mat-divider>

    
  <div class="payment-summary" *ngIf="coffee$ | async as coffee">
    <h3>Resumo do Pedido</h3>

    <!-- Dados principais do pedido -->
    <div class="row">
      <span>Café</span>
      <span>{{ orderForm.get('coffeeName')?.value || coffee.name }}</span>
    </div>

    <div class="row">
      <span>Tamanho</span>
      <span>{{ orderForm.get('size')?.value }}</span>
    </div>

    <div class="row">
      <span>Quantidade</span>
      <span>{{ orderForm.get('quantity')?.value }}</span>
    </div>

    <mat-divider></mat-divider>

    <!-- Cupom aplicado -->
    <ng-container *ngIf="coupon$ | async as coupon; else noCoupon">
      <div class="row">
        <span>Cupom aplicado</span>
        <span>{{ coupon.code }} ({{ coupon.discountPercentage }}%)</span>
      </div>

      <!-- Total com desconto -->
      <div class="row total">
        <span>Total</span>
        <strong>
          {{
            calculateDiscountedTotal(
              coffee.price,
              orderForm.get('quantity')?.value,
              coupon.discountPercentage
            ) | currency:'BRL':'symbol':'1.2-2'
          }}
        </strong>
      </div>
    </ng-container>

    <!-- Caso não haja cupom -->
    <ng-template #noCoupon>
      <div class="row total">
        <span>Total</span>
        <strong>
          {{
            calculateTotalWithoutDiscount(
              coffee.price,
              orderForm.get('quantity')?.value
            ) | currency:'BRL':'symbol':'1.2-2'
          }}
        </strong>
      </div>
    </ng-template>
</div>

  </div>

  <!-- Botão de pedido -->
  <div class="order-btn-container">
    <div class="payment-method">
      <button mat-flat-button color="primary" class="order-btn" (click)="submitOrder()">Pedir</button>
    </div>
  </div>
</div>
